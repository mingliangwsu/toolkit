#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Tue Oct  6 00:37:02 2020

@author: liuming
"""

import pandas as pd
import sys 
import os
import math
import re
from os import path
#from copy import deepcopy

def sortkey(x): 
    return int(x)

path = "/home/liuming/mnt/hydronas1/Projects/UW_subcontract/Calibration/final_soil_parameter"
ecoregion_file = path + "/wavic_ecoregion.txt"
orig_soilfile = path + "/wa_soil_ext_neighbor_gNATSGO.txt"
new_soilfile_pre = path + "/soilset_"
#ecoregion 1: 3,7,8,9
#ecoregion 2: 3,9,10,31
#ecoregion 3: 7,22,30,39

pecoset = {
        "1" : [3, 7, 8, 9, 10],
        "2" : [3, 9, 10, 31, 14],
        "3" : [7, 22, 30, 39, 14]
        }

bi = ["0.0958", "0.0858", "0.3850", "0.1855", "0.1456", "0.3052", "0.0658", "0.2354", "0.2853", "0.1257", "0.0758", "0.3451", "0.3751", "0.0359", "0.2953", "0.3651", "0.2653", "0.1656", "0.1357", "0.1955", "0.3950", "0.2454", "0.0160", "0.2155", "0.1556", "0.1756", "0.0559", "0.3152", "0.1057", "0.2254", "0.0259", "0.2055", "0.2753", "0.3551", "0.2554", "0.3352", "0.1157", "0.0060", "0.3252", "0.0459"]
DsMAX = ["1.8844", "5.6331", "28.8754", "16.8794", "25.8764", "2.6341", "10.8814", "7.8824", "16.1296", "13.1306", "11.6311", "25.1266", "3.3839", "6.3829", "4.1336", "18.3789", "22.8774", "13.8804", "22.1276", "19.1286", "21.3779", "4.8834", "8.6321", "29.6251", "17.6291", "15.3799", "12.3809", "23.6271", "19.8784", "20.6281", "0.3849", "9.3819", "24.3769", "14.6301", "28.1256", "27.3759", "7.1326", "26.6261", "10.1316", "1.1346"]
Ds = ["0.4626", "0.4126", "0.2376", "0.1126", "0.5625", "0.9125", "0.9625", "0.0876", "0.0376", "0.0626", "0.1626", "0.5375", "0.8375", "0.9875", "0.3376", "0.1876", "0.9375", "0.3126", "0.4876", "0.1376", "0.3876", "0.7125", "0.0126", "0.7625", "0.4376", "0.6875", "0.6625", "0.6125", "0.8625", "0.7375", "0.8125", "0.2876", "0.5125", "0.2126", "0.7875", "0.6375", "0.8875", "0.5875", "0.3626", "0.2626"]
Ws = ["0.1461", "0.4679", "0.7401", "0.6906", "0.3441", "0.2204", "0.3936", "0.9876", "0.2451", "0.2946", "0.5916", "0.9381", "0.0224", "0.2699", "0.6659", "0.6164", "0.4184", "0.0966", "0.1956", "0.3194", "0.6411", "0.0471", "0.7154", "0.8639", "0.1214", "0.8391", "0.8144", "0.0719", "0.9629", "0.5669", "0.9134", "0.7649", "0.1709", "0.3689", "0.4926", "0.7896", "0.4431", "0.8886", "0.5174", "0.5421"]
D2 = ["2.9625", "1.9129", "0.9382", "2.5127", "0.3384", "0.8632", "1.4630", "1.1631", "1.7629", "1.0881", "2.1378", "0.6383", "0.7133", "2.8126", "1.8379", "2.7376", "1.2381", "2.3627", "0.1884", "2.6626", "1.3131", "1.0132", "2.5876", "2.2877", "1.6879", "2.8875", "0.2634", "0.4883", "1.5380", "1.9878", "1.3880", "2.2128", "0.7882", "2.4377", "0.1135", "0.5633", "0.0385", "0.4134", "1.6130", "2.0628"]

grideco = dict()
with open(ecoregion_file,"r") as f:
    for line in f:
        a = line.rstrip().split()
        if (len(a) == 2):
            if "grid_code" not in a:
                if a[0] not in grideco:
                    grideco[a[0]] = a[1]

original_soil = dict()
with open(orig_soilfile,"r") as f:
    for line in f:
        a = line.rstrip().split()
        if (len(a) > 1):
            if a[1] not in original_soil:
                original_soil[a[1]] = a

for pset in [0,1,2,3,4]:
#for pset in [0,1,2,3]:
    print(str(pset))
    outsoil = new_soilfile_pre + str(pset) + ".txt"
    with open(outsoil,"w") as f:
        for grid in sorted(original_soil, key=sortkey, reverse=False):
            eco = grideco[grid]
            soilset = pecoset[eco][pset]                                       #set index
            outa = list(original_soil[grid])
            outa[4] = bi[soilset]
            outa[5] = Ds[soilset]
            outa[6] = DsMAX[soilset]
            outa[7] = Ws[soilset]
            outa[24] = D2[soilset]
            
            wline = ""
            for rec in outa:
                wline += rec + " "
            wline += "\n"
            f.write(wline)
            
            